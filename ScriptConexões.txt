#!/bin/bash

checkPing(){
	ping -c2 -W2 "$HOST" > /dev/null;
}

checkSSH(){
	sshpass -p ${PASS} ssh -o StrictHostKeyChecking=no $USER@$HOST hostname >> ips_ok.txt;
}	

for i in `cat Lista_mypms.csv`; do

	USER=`echo $i | awk -F"," '{print $1}'`
	HOST=`echo $i | awk -F"," '{print $2}'`
	PASS=`echo $i | awk -F"," '{print $3}'`

	if checkPing; then
		echo "----------------------------------------------------------"
		echo "             IP "$HOST" Válido                            "
		echo "----------------------------------------------------------"

		if checkSSH; then
			echo "----------------------------------------------------------"
			echo "					***Conectado***                         "
			echo "----------------------------------------------------------"
		else
			echo "----------------------------------------------------------"
			echo "               ###Senha Inválida###                       "
			echo "----------------------------------------------------------"
			echo "$HOST" >> ips_nok.txt
		fi

	else
		echo "----------------------------------------------------------"
		echo "             IP "$HOST" Inválido                          "
		echo "----------------------------------------------------------"
		echo "$HOST" >> ips_off.txt

	fi
done
exit 0
